---
alwaysApply: true
---
# MS.TrustTest Project Rules

## üö® CRITICAL RULES - KH√îNG ƒê∆Ø·ª¢C VI PH·∫†M

### 1. Spring Boot Context Path Rule
**APPLICATION.YML ƒê√É C·∫§U H√åNH:**
```yaml
server:
  servlet:
    context-path: /api
```

**‚ö†Ô∏è QUAN TR·ªåNG:**
- T·∫§T C·∫¢ Controllers KH√îNG ƒê∆Ø·ª¢C c√≥ `/api` trong `@RequestMapping`
- Base path trong Controller ch·ªâ c·∫ßn: `@RequestMapping("/resource-name")`
- URL cu·ªëi c√πng s·∫Ω l√†: `http://localhost:8080/api/resource-name`

**‚úÖ ƒê√öNG:**
```java
@RestController
@RequestMapping("/exams")  // ‚úì Correct
public class ExamController { }
```

**‚ùå SAI:**
```java
@RestController
@RequestMapping("/api/exams")  // ‚úó WRONG - T·∫°o ra /api/api/exams
public class ExamController { }
```

### 2. Comment Format Rules

**Java/TypeScript:**
```java
/* ---------------------------------------------------
 * (M·ª•c ƒë√≠ch h√†m)
 * @param paramName (√ù nghƒ©a tham s·ªë, ki·ªÉu d·ªØ li·ªáu)
 * @returns D·ªØ li·ªáu tr·∫£ v·ªÅ (n·∫øu c√≥)
 * @author: K24DTCN210-NVMANH (ng√†y/th√°ng/nƒÉm gi·ªù:ph√∫t)
 * EditBy: K24DTCN210-NVMANH (ng√†y/th√°ng/nƒÉm gi·ªù:ph√∫t) - (L√Ω do)
 * --------------------------------------------------- */
```

**C#:**
```csharp
/// <summary>
/// (M·ª•c ƒë√≠ch h√†m)
/// </summary>
/// <param name="param1">(Tham s·ªë 1 l√† g√¨)</param>
/// <returns>(D·ªØ li·ªáu tr·∫£ v·ªÅ - n·∫øu c√≥)</returns>
/// CreatedBy: K24DTCN210-NVMANH (ng√†y/th√°ng/nƒÉm gi·ªù:ph√∫t)
/// UpdateBy: K24DTCN210-NVMANH (ng√†y/th√°ng/nƒÉm gi·ªù:ph√∫t) - (L√Ω do)
```

### 3. Entity Technical Notes

**SubjectClass Entity:**
- ‚ùå KH√îNG c√≥ field `name` (ch·ªâ c√≥ `code`)
- ‚ùå KH√îNG c√≥ method `getClassEntity()`
- ‚úÖ S·ª≠ d·ª•ng `getCode()` thay v√¨ `getName()`

**Current User Helper:**
```java
private Long getCurrentUserId() {
    Authentication auth = SecurityContextHolder.getContext().getAuthentication();
    String email = auth.getName();
    User user = userRepository.findByEmail(email)
        .orElseThrow(() -> new RuntimeException("User not found"));
    return user.getId();
}
```

**Question Count:**
```java
// Repository returns long, c·∫ßn cast to int
int questionCount = (int) examQuestionRepository.countByExamId(examId);
```

### 4. Soft Delete Pattern
- S·ª≠ d·ª•ng `deletedAt` field
- KH√îNG x√≥a v·∫≠t l√Ω records
- Check `deletedAt IS NULL` trong queries

### 5. Vietnamese Language
- G·ªçi user l√† "c·ª• M·∫°nh"
- T·ª± x∆∞ng l√† "con"
- Code comments b·∫±ng ti·∫øng Vi·ªát c√≥ d·∫•u

## üìã Common Patterns

### Controller Standard Structure:
```java
@RestController
@RequestMapping("/resource-name")  // NO /api prefix!
@RequiredArgsConstructor
public class ResourceController {
    private final ResourceService service;
    private final UserRepository userRepository;
    
    @PostMapping
    @PreAuthorize("hasAnyRole('TEACHER', 'DEPT_MANAGER', 'ADMIN')")
    public ResponseEntity<ResourceDTO> create(@Valid @RequestBody CreateRequest request) {
        Long userId = getCurrentUserId();
        return ResponseEntity.status(HttpStatus.CREATED)
            .body(service.create(request, userId));
    }
}
```

### Service Layer Pattern:
```java
@Service
@RequiredArgsConstructor
@Transactional
public class ResourceService {
    private final ResourceRepository repository;
    
    public ResourceDTO create(CreateRequest request, Long userId) {
        // Validation
        // Business logic
        // Save
        // Return DTO
    }
}
```

## üîß Build & Run Commands

```bash
# Clean compile
cd backend; mvn clean compile

# Run server
cd backend; mvn spring-boot:run

# Stop server
cd backend; mvn spring-boot:stop
```

## üìù Documentation Requirements

M·ªói feature completion c·∫ßn:
1. Technical documentation (MD file)
2. Thunder Client test collection
3. API test cases
4. Update memory bank

## ‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p

1. **Context-path conflict** ‚Üí Check @RequestMapping kh√¥ng c√≥ /api
2. **SubjectClass.getName()** ‚Üí D√πng getCode()
3. **Question count type** ‚Üí Cast long to int
4. **CustomUserDetails** ‚Üí D√πng Authentication directly

---
*Last Updated: 19/11/2025 09:44*
*By: K24DTCN210-NVMANH*
