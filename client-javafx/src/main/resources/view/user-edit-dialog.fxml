<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns="http://javafx.com/javafx" 
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.mstrust.client.admin.controller.UserEditDialogController"
            styleClass="user-dialog-container"
            stylesheets="@../css/admin-styles.css, @../css/teacher-styles.css"
            prefWidth="800" prefHeight="750">
    
    <!-- Header với icon và title -->
    <top>
        <HBox styleClass="dialog-header" alignment="CENTER_LEFT" spacing="12">
            <padding>
                <Insets top="20" right="25" bottom="15" left="25"/>
            </padding>
            <FontIcon iconLiteral="fas-user-plus" iconSize="24" iconColor="#1976d2"/>
            <Label fx:id="dialogTitle" styleClass="page-title" text="Tạo người dùng mới"/>
        </HBox>
    </top>
    
    <!-- Content với ScrollPane -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="user-dialog-scroll" vbarPolicy="AS_NEEDED">
            <VBox spacing="20" styleClass="user-dialog-content">
                <padding>
                    <Insets top="25" right="30" bottom="25" left="30"/>
                </padding>
                
                <!-- Basic Information Section -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Thông tin cơ bản" styleClass="section-title"/>
                    
                    <!-- Full Name -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-user" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Họ tên:" minWidth="110" styleClass="form-label"/>
                        <TextField fx:id="fullNameField" promptText="Nhập họ và tên đầy đủ" 
                                   styleClass="form-field" prefWidth="380"/>
                        <Label text="*" styleClass="required-mark"/>
                        <Label fx:id="fullNameErrorLabel" styleClass="error-label" visible="false" 
                               text="Họ tên không được để trống"/>
                    </HBox>
                    
                    <!-- Email -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-envelope" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Email:" minWidth="110" styleClass="form-label"/>
                        <TextField fx:id="emailField" promptText="example@email.com" 
                                   styleClass="form-field" prefWidth="380"/>
                        <Label text="*" styleClass="required-mark"/>
                        <Label fx:id="emailErrorLabel" styleClass="error-label" visible="false" 
                               text="Email không hợp lệ"/>
                    </HBox>
                    
                    <!-- Password (chỉ hiển thị khi tạo mới) -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row" fx:id="passwordContainer">
                        <FontIcon iconLiteral="fas-lock" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Mật khẩu:" minWidth="110" styleClass="form-label"/>
                        <PasswordField fx:id="passwordField" promptText="Tối thiểu 6 ký tự" 
                                       styleClass="form-field" prefWidth="280"/>
                        <Label text="*" styleClass="required-mark"/>
                        <Label fx:id="passwordErrorLabel" styleClass="error-label" visible="false" 
                               text="Mật khẩu phải có ít nhất 6 ký tự"/>
                    </HBox>
                    
                    <!-- Student Code -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-id-card" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Mã SV:" minWidth="110" styleClass="form-label"/>
                        <TextField fx:id="studentCodeField" promptText="Ví dụ: SV001" 
                                   styleClass="form-field" prefWidth="200"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                    </HBox>
                    
                    <!-- Phone Number -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-phone" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Số điện thoại:" minWidth="110" styleClass="form-label"/>
                        <TextField fx:id="phoneNumberField" promptText="Ví dụ: 0123456789" 
                                   styleClass="form-field" prefWidth="200"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                    </HBox>
                </VBox>
                
                <!-- Personal Information Section -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Thông tin cá nhân" styleClass="section-title"/>
                    
                    <!-- Date of Birth -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-calendar-alt" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Ngày sinh:" minWidth="110" styleClass="form-label"/>
                        <DatePicker fx:id="dateOfBirthPicker" styleClass="form-field" prefWidth="200"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                    </HBox>
                    
                    <!-- Gender -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-venus-mars" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Giới tính:" minWidth="110" styleClass="form-label"/>
                        <ComboBox fx:id="genderCombo" promptText="-- Chọn giới tính --" 
                                  styleClass="combo-box" prefWidth="200"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                    </HBox>
                    
                    <!-- Address -->
                    <VBox spacing="8" styleClass="textarea-container">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <FontIcon iconLiteral="fas-map-marker-alt" iconSize="16" iconColor="#546e7a"/>
                            <Label text="Địa chỉ:" styleClass="form-label"/>
                            <Label text="(Tùy chọn)" styleClass="hint-text"/>
                        </HBox>
                        <TextArea fx:id="addressArea" 
                                  promptText="Nhập địa chỉ chi tiết..." 
                                  styleClass="form-field" prefHeight="80" wrapText="true">
                            <VBox.margin>
                                <Insets left="28"/>
                            </VBox.margin>
                        </TextArea>
                    </VBox>
                </VBox>
                
                <!-- Organization Information Section -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Thông tin tổ chức" styleClass="section-title"/>
                    
                    <!-- Department -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-building" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Khoa:" minWidth="110" styleClass="form-label"/>
                        <ComboBox fx:id="departmentCombo" promptText="-- Chọn khoa --" 
                                  styleClass="combo-box" prefWidth="280"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                        <Label fx:id="departmentErrorLabel" styleClass="error-label" visible="false"/>
                    </HBox>
                    
                    <!-- Class -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-users" iconSize="16" iconColor="#546e7a"/>
                        <Label text="Lớp:" minWidth="110" styleClass="form-label"/>
                        <ComboBox fx:id="classCombo" promptText="-- Chọn lớp --" 
                                  styleClass="combo-box" prefWidth="280" disable="true"/>
                        <Label text="(Tùy chọn)" styleClass="hint-text"/>
                        <Label fx:id="classErrorLabel" styleClass="error-label" visible="false"/>
                    </HBox>
                </VBox>
                
                <!-- Role and Status Section -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Vai trò và trạng thái" styleClass="section-title"/>
                    
                    <!-- Roles -->
                    <VBox spacing="8" styleClass="roles-container">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <FontIcon iconLiteral="fas-user-tag" iconSize="16" iconColor="#546e7a"/>
                            <Label text="Vai trò:" styleClass="form-label"/>
                        </HBox>
                        <VBox fx:id="rolesContainer" spacing="8">
                            <VBox.margin>
                                <Insets left="28"/>
                            </VBox.margin>
                            <!-- Roles sẽ được thêm động -->
                        </VBox>
                    </VBox>
                    
                    <!-- Active Status -->
                    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="input-row">
                        <FontIcon iconLiteral="fas-toggle-on" iconSize="16" iconColor="#4caf50"/>
                        <CheckBox fx:id="isActiveCheckBox" text="Tài khoản đang hoạt động" 
                                  styleClass="status-checkbox" selected="true"/>
                    </HBox>
                </VBox>
                
                <!-- Validation Summary -->
                <VBox fx:id="validationSummary" spacing="5" styleClass="validation-summary" 
                      visible="false" managed="false">
                    <Label text="⚠️ Vui lòng kiểm tra các lỗi sau:" styleClass="error-label"/>
                    <Label fx:id="validationMessage" styleClass="hint-text" 
                           text="- Các trường bắt buộc phải được điền đầy đủ"/>
                </VBox>
            </VBox>
        </ScrollPane>
    </center>
    
    <!-- Action Buttons -->
    <bottom>
        <HBox spacing="12" alignment="CENTER_RIGHT" styleClass="user-dialog-footer">
            <padding>
                <Insets top="20" right="30" bottom="25" left="30"/>
            </padding>
            
            <Button text="Hủy" onAction="#handleCancel" styleClass="secondary-button" 
                    prefWidth="120" prefHeight="40">
                <graphic>
                    <FontIcon iconLiteral="fas-times" iconSize="14" iconColor="#757575"/>
                </graphic>
            </Button>
            <Button fx:id="saveButton" text="Lưu" onAction="#handleSave" 
                    styleClass="primary-button" prefWidth="120" prefHeight="40">
                <graphic>
                    <FontIcon iconLiteral="fas-save" iconSize="14" iconColor="white"/>
                </graphic>
            </Button>
        </HBox>
    </bottom>
</BorderPane>

