server {
    listen 80;
    server_name ttapi.manhhao.com;

    # LƯU Ý: Đã dùng hardcode "upgrade" thay vì biến $connection_upgrade
    # Không cần thêm map vào nginx.conf - file này có thể dùng ngay

    # Location cho các path bắt đầu bằng /api (ưu tiên cao hơn)
    location /api {
        # Proxy đến backend, giữ nguyên path
        # User truy cập: https://ttapi.manhhao.com/api/swagger-ui.html
        # → Nginx proxy đến: localhost:8181/api/swagger-ui.html ✅
        proxy_pass http://localhost:8181;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts cho long-running requests
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Location cho root path (fallback - thêm /api prefix)
    location / {
        # Proxy đến backend với /api prefix
        # User truy cập: https://ttapi.manhhao.com/swagger-ui.html
        # → Nginx proxy đến: localhost:8181/api/swagger-ui.html ✅
        proxy_pass http://localhost:8181/api;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts cho long-running requests
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
}

